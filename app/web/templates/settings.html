{% extends "base.html" %}

{% block title %}Settings - tree-eclass{% endblock %}

{% block content %}
<div class="page-header">
	<h1>Settings</h1>
</div>

<!-- E-Class Credentials Section -->
<div class="section">
	<h2>E-Class Credentials</h2>
	<div class="info-card">
		<p>Your e-class credentials are stored in plaintext in the local SQLite database. They are used to authenticate
			when
			checking for course updates.</p>
		{% if credentials %}
		<p class="status-success">✓ Credentials are currently configured</p>
		{% else %}
		<p class="status-warning">⚠ No credentials configured</p>
		{% endif %}
	</div>

	<div class="form-card">
		<form method="POST" action="/settings/credentials">
			<div class="form-group">
				<label for="username">Username</label>
				<input type="text" id="username" name="username"
					value="{% if credentials %}{{ credentials[0] }}{% endif %}" required placeholder="e.g., p3220XYZ">
			</div>
			<div class="form-group">
				<label for="password">Password</label>
				<input type="password" id="password" name="password" required placeholder="Enter your password">
			</div>
			<button type="submit" class="btn btn-primary">{% if credentials %}Update{% else %}Save{% endif %}
				Credentials</button>
		</form>
	</div>
</div>

<!-- Email Configuration Section -->
<div class="section">
	<h2>Email Notifications</h2>
	<div class="info-card">
		<p>Configure SMTP settings to receive email notifications when file changes are detected in your courses.</p>
		{% if email_config %}
		<p class="status-success">✓ Email configuration is set</p>
		{% else %}
		<p class="status-warning">⚠ Email not configured - you won't receive notifications</p>
		{% endif %}
	</div>

	<div class="form-card">
		<form method="POST" action="/settings/email">
			<div class="form-group">
				<label for="smtp_server">SMTP Server</label>
				<input type="text" id="smtp_server" name="smtp_server"
					value="{% if email_config %}{{ email_config.smtp_server }}{% endif %}" required
					placeholder="e.g., smtp.gmail.com">
			</div>

			<div class="form-group">
				<label for="smtp_port">SMTP Port</label>
				<input type="number" id="smtp_port" name="smtp_port"
					value="{% if email_config %}{{ email_config.smtp_port }}{% else %}587{% endif %}" required
					placeholder="587">
			</div>

			<div class="form-group">
				<label for="use_tls">
					<input type="checkbox" id="use_tls" name="use_tls" value="true" {% if not email_config or
						email_config.use_tls %}checked{% endif %}>
					Use TLS/STARTTLS
				</label>
			</div>

			<div class="form-group">
				<label for="smtp_username">SMTP Username (optional)</label>
				<input type="text" id="smtp_username" name="smtp_username"
					value="{% if email_config %}{{ email_config.smtp_username }}{% endif %}"
					placeholder="Usually your email address">
			</div>

			<div class="form-group">
				<label for="smtp_password">SMTP Password (optional)</label>
				<input type="password" id="smtp_password" name="smtp_password"
					placeholder="Enter SMTP password (will be stored in plaintext in local database)">
			</div>

			<div class="form-group">
				<label for="from_email">From Email Address</label>
				<input type="email" id="from_email" name="from_email"
					value="{% if email_config %}{{ email_config.from_email }}{% endif %}" required
					placeholder="noreply@example.com">
				<small>The sender address for notifications</small>
			</div>

			<div class="form-group">
				<label for="to_email">To Email Address</label>
				<input type="email" id="to_email" name="to_email"
					value="{% if email_config %}{{ email_config.to_email }}{% endif %}" required
					placeholder="your-email@example.com">
				<small>Where notifications will be sent</small>
			</div>

			<button type="submit" class="btn btn-primary">
				{% if email_config %}Update{% else %}Save{% endif %} Email Configuration
			</button>
		</form>
	</div>

</div>

<!-- Application Preferences Section -->
<div class="section">
	<h2>Application Preferences</h2>
	<div class="info-card">
		<p>Configure scan intervals, timeouts, and notification preferences.</p>
	</div>

	<div class="form-card">
		<form method="POST" action="/settings/preferences">
			<div class="form-group">
				<label for="check_interval_minutes">Check Interval (minutes)</label>
				<input type="number" id="check_interval_minutes" name="check_interval_minutes"
					value="{{ preferences.check_interval_minutes }}" required min="5" max="1440">
				<small>How often to check for changes (5-1440 minutes)</small>
			</div>

			<div class="form-group">
				<label for="request_timeout_seconds">Request Timeout (seconds)</label>
				<input type="number" id="request_timeout_seconds" name="request_timeout_seconds"
					value="{{ preferences.request_timeout_seconds }}" required min="10" max="300">
				<small>HTTP request timeout (10-300 seconds)</small>
			</div>

			<div class="form-group">
				<label for="max_concurrent_downloads">Max Concurrent Downloads</label>
				<input type="number" id="max_concurrent_downloads" name="max_concurrent_downloads"
					value="{{ preferences.max_concurrent_downloads }}" required min="1" max="10">
				<small>Maximum parallel downloads (1-10)</small>
			</div>

			<div class="form-group">
				<label for="retry_attempts">Retry Attempts</label>
				<input type="number" id="retry_attempts" name="retry_attempts" value="{{ preferences.retry_attempts }}"
					required min="0" max="10">
				<small>Number of retries on failed requests (0-10)</small>
			</div>

			<div class="form-group">
				<label for="notification_enabled">
					<input type="checkbox" id="notification_enabled" name="notification_enabled" value="true" {% if
						preferences.notification_enabled %}checked{% endif %}>
					Enable Notifications
				</label>
				<small>Send email notifications when changes are detected</small>
			</div>

			<div class="form-group">
				<label for="notification_on_error">
					<input type="checkbox" id="notification_on_error" name="notification_on_error" value="true" {% if
						preferences.notification_on_error %}checked{% endif %}>
					Notify on Errors
				</label>
				<small>Send email notifications when errors occur during checks</small>
			</div>

			<button type="submit" class="btn btn-primary">Save Preferences</button>
		</form>
	</div>
</div>
{% endblock %}